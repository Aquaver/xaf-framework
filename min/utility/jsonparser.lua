local a=require("unicode")local b={C_NAME="Generic JSON Parser",C_INSTANCE=true,C_INHERIT=true,static={}}function b:initialize()local c=nil;local d=c and c.private or{}local e=c and c.public or{}d.currentCharacter=''d.currentIndex=0;d.inputData=''d.stringEscapes={['b']="\b",['n']="\n",['t']="\t",['r']="\r",['f']="\f",['\"']='\"',["\\"]="\\"}d.getNextCharacter=function(self)d.currentIndex=d.currentIndex+1;d.currentCharacter=string.sub(d.inputData,d.currentIndex+1,d.currentIndex+1)return d.currentCharacter end;d.getValue=function(self)if d.currentCharacter=='['then return d:parseArray()elseif d.currentCharacter=='t'or d.currentCharacter=='f'then return d:parseBoolean()elseif d.currentCharacter=='n'then return d:parseNull()elseif d.currentCharacter=='-'or d.currentCharacter and d.currentCharacter>='0'and d.currentCharacter<='9'then return d:parseNumber()elseif d.currentCharacter=='{'then return d:parseObject()elseif d.currentCharacter=='\"'then return d:parseString()else error("[XAF Error] Syntax error encountered while parsing JSON data")end end;d.parseArray=function(self)local f={}if d.currentCharacter=='['then if d:getNextCharacter()==']'then return f end;repeat table.insert(f,d:getValue())if d.currentCharacter==']'then d:getNextCharacter()return f end until not(d.currentCharacter and d.currentCharacter==','and d:getNextCharacter())else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing array")end end;d.parseBoolean=function(self)local g=''if d.currentCharacter=='t'then for h=1,4 do g=g..d.currentCharacter;d:getNextCharacter()end;if g=="true"then return true else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing boolean (true)")end elseif d.currentCharacter=='f'then for h=1,5 do g=g..d.currentCharacter;d:getNextCharacter()end;if g=="false"then return false else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing boolean (false)")end else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing boolean")end end;d.parseNull=function(self)local i=''if d.currentCharacter=='n'then for h=1,4 do i=i..d.currentCharacter;d:getNextCharacter()end;if i=="null"then return nil else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing null")end else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing null")end end;d.parseNumber=function(self)local j=''if d.currentCharacter=='-'then j=j..d.currentCharacter;d:getNextCharacter()end;while d.currentCharacter and d.currentCharacter>='0'and d.currentCharacter<='9'do j=j..d.currentCharacter;d:getNextCharacter()end;if d.currentCharacter=='.'then j=j..d.currentCharacter;d:getNextCharacter()while d.currentCharacter and d.currentCharacter>='0'and d.currentCharacter<='9'do j=j..d.currentCharacter;d:getNextCharacter()end end;if d.currentCharacter=='e'or d.currentCharacter=='E'then j=j..d.currentCharacter;d:getNextCharacter()if d.currentCharacter=='-'or d.currentCharacter=='+'then j=j..d.currentCharacter;d:getNextCharacter()end;while d.currentCharacter and d.currentCharacter>='0'and d.currentCharacter<='9'do j=j..d.currentCharacter;d:getNextCharacter()end end;if tonumber(j)then return tonumber(j)else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing number")end end;d.parseObject=function(self)local k={}if d.currentCharacter=='{'then if d:getNextCharacter()=='}'then return k end;repeat local l=d:parseString()if d.currentCharacter==':'then d:getNextCharacter()k[l]=d:getValue()if d.currentCharacter=='}'then d:getNextCharacter()return k end else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing object (colon expected)")end until not(d.currentCharacter and d.currentCharacter==','and d:getNextCharacter())else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing object")end end;d.parseString=function(self)local m=''if d.currentCharacter=='\"'then d:getNextCharacter()while d.currentCharacter do if d.currentCharacter=='\"'then d:getNextCharacter()return m end;if d.currentCharacter=="\\"then d:getNextCharacter()if d.stringEscapes[d.currentCharacter]then m=m..d.stringEscapes[d.currentCharacter]else m=m..d.currentCharacter end else m=m..d.currentCharacter end;d:getNextCharacter()end else error("[XAF Error] Syntax error encountered while parsing JSON data - parsing string")end end;d.removeWhitespaces=function(self,n)local o=''local p=''local q=false;local r=a.wlen(n)local s=''for h=1,r do o=string.sub(n,h,h)if o=='\"'then if p=="\\"then s=s..p..o else q=not q;s=s..o end elseif string.find(o,"%s")then if q==true then s=s..o end else s=s..o end;p=o end;return s end;e.parse=function(self,t)assert(type(t)=="string","[XAF Core] Expected STRING as argument #1")d.inputData=d:removeWhitespaces(t)d.currentCharacter=string.sub(d.inputData,1,1)d.currentIndex=0;return d:getValue(d.inputData)end;return{private=d,public=e}end;function b:extend()local u=self:initialize()local d=u.private;local e=u.public;if self.C_INHERIT==true then return{private=d,public=e}else error("[XAF Error] Class '"..tostring(self.C_NAME).."' cannot be inherited")end end;function b:new()local u=self:initialize()local d=u.private;local e=u.public;if self.C_INSTANCE==true then return e else error("[XAF Error] Class '"..tostring(self.C_NAME).."' cannot be instanced")end end;return b
