local a,b=...local c=require("component")local d=require("xaf/utility/httpstream")local e=require("xaf/core/xafcore")local f=e:getTableInstance()if b.h==true or b.help==true then print("-----------------------------------------------")print("-- Extensible Application Framework - Manual --")print("-----------------------------------------------")print("  >> NAME")print("    >> xaf check - Automated checking for update script")print()print("  >> SYNOPSIS")print("    >> xaf check")print("    >> xaf check [-h | --help]")print()print("  >> DESCRIPTION")print("    >> This program let the user check for package updates and notifies if it is available.")os.exit()end;if c.isAvailable("internet")==false then print("---------------------------------------------------")print("-- Extensible Application Framework - Controller --")print("---------------------------------------------------")print("  >> Internet card component is not available")print("  >> Checking for update procedure cannot be continued")os.exit()else print("---------------------------------------------------")print("-- Extensible Application Framework - Controller --")print("---------------------------------------------------")print("  >> Internet card component found")print("  >> Trying to connect to project repository...")end;local g="https://raw.githubusercontent.com/Aquaver/xaf-framework/"local h="master"local i="/package/package.info"local j=''local k=g..h..i;local l=c.getPrimary("internet")local m=d:new(l,k)if m.connect()==true then for n in m:getData()do j=j..n end;m.disconnect()else print("    >> Cannot connect to project repository")print("    >> Try running 'xaf check' again")os.exit()end;local o=f:loadFromString(j)local p=o.package_name;local q=o.package_stable;local r=o.package_version;local s=_G._XAF._VERSION;if r==s then print("    >> Installed package version is equal to latest version ("..s..')')print("    >> Thank you for keeping XAF up to date")print("    >> Update checking procedure has been finished")else print("    >> New version detected (local: "..s..", remote: "..r..')')print("    >> Use 'xaf update "..r.."' to download and install this version")if q=="true"then print("      >> This version is marked as 'stable'")print("      >> All changes are fully backward compatible")elseif q=="false"then print("      >> Warning! This version is not marked as 'stable'")print("      >> You may experience some bugs in this software")else print("      >> Unknown release stage: '"..q.."'")print("      >> Please notify the author about that")print("      >> Thank you for your feedback")end;print("    >> Update checking procedure has been finished")end
